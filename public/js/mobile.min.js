function inArray(a,b,c){return null==b?-1:b.indexOf(a,c)}function stopPropagation(a){if(!a)var a=window.event;a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()}function getEventCoords(a){var b=0,c=0;if(!a)var a=window.event;return a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:b,y:c}}function setInnerHTML(a,b){var c=document.getElementById(a);c.innerHTML=b}function getInnerHTML(a){var b=document.getElementById(a);return b.innerHTML}function ajax(a){var b;window.XMLHttpRequest?b=new XMLHttpRequest:window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP")),b.onreadystatechange=function(){if(4==b.readyState&&(200==b.status||304==b.status)){var c=JSON.parse(b.responseText);a.success(c)}},b.open("GET",a.url,!0),b.send(null)}function normalizedArea(){this.fill=function(a){var b=a.getSouthWest().lat(),c=a.getSouthWest().lng(),d=a.getNorthEast().lat(),e=a.getNorthEast().lng(),f=d-b,g=e-c;this.yMin=Math.floor(b/f),this.xMin=Math.floor(c/g),this.yMax=Math.ceil(d/f),this.xMax=Math.ceil(e/g),this.latSW=this.yMin*f,this.lngSW=this.xMin*g,this.latNE=this.yMax*f,this.lngNE=this.xMax*g},this.assign=function(a){this.yMin=a.yMin,this.xMin=a.xMin,this.yMax=a.yMax,this.xMax=a.xMax,this.latSW=a.latSW,this.lngSW=a.lngSW,this.latNE=a.latNE,this.lngNE=a.lngNE},this.equals=function(a){var b=a&&this.yMin&&a.yMin&&this.yMin==a.yMin&&this.xMin&&a.xMin&&this.xMin==a.xMin&&this.yMax&&a.yMax&&this.yMax==a.yMax&&this.xMax&&a.xMax&&this.xMax==a.xMax;return b}}function updateMarkerImages(a){for(var b in a)a[b].selectImage()}function trackLocation(a){a&&(document.getElementById("btnfocus").className="bbarbtn btnfocuson",vici.trackLocation=!0,vici.map.setCenter(vici.here.position)),a||(document.getElementById("btnfocus").className="bbarbtn btnfocusoff",vici.trackLocation=!1)}function displayAllMarkers(a){a&&!vici.showAllMarkers&&(document.getElementById("btnall").className="bbarbtn btnfont btnallon",document.getElementById("btnvisual").className="bbarbtn btnfont btnvisualoff",vici.showAllMarkers=!0,updateMarkerImages(vici.markerArr)),!a&&vici.showAllMarkers&&(document.getElementById("btnall").className="bbarbtn btnfont btnalloff",document.getElementById("btnvisual").className="bbarbtn btnfont btnvisualon",vici.showAllMarkers=!1,updateMarkerImages(vici.markerArr))}function displayLabels(a){if(a){var b={mapTypeId:google.maps.MapTypeId.HYBRID};document.getElementById("btnlabels").className="bbarbtn btnlabelson"}else{var b={mapTypeId:google.maps.MapTypeId.SATELLITE};document.getElementById("btnlabels").className="bbarbtn btnlabelsoff"}vici.map.setOptions(b),vici.showLabels=a}function removePopup(){vici.selectedImage&&(popup.style.display="none",vici.selectedImage=null,document.getElementById("page").onclick=null)}function togglePopup(a,b,c){var e;e=document.getElementById("popup"),"block"==e.style.display&&a==vici.selectedImage?removePopup():(e=document.getElementById("popup"),e.innerHTML=vici.popupsArr[a],e.style.top=c+"px",e.style.display="block",vici.selectedImage=a,document.getElementById("page").onclick=function(a){stopPropagation(a),vici.selectedImage&&(document.getElementById("popup").style.display="none",vici.selectedImage=null)})}function showPage(a){function c(a){function b(a){var b="";return a.title&&(b+=a.title+"<br>"),a.description&&(b+=a.description+"<br>"),"1"==a.ownwork?b+=strings.CreatedBy+a.uploader+" - "+a.license+"<br>":(b+=a.attribution?a.attribution:strings.CreatedBy+a.creator,"Unknown"!=a.license&&(b+=" - "+a.license)),"<p>"+b+"</p>"}if(a.properties.images[0]){var c=!0,d="";for(var f in a.properties.images){var g=a.properties.images[f];"1"!=g.isdefault&&(c&&(d+="<h2>"+strings.MoreImages+"</h2>",c=!1),d+='<img id="img'+f+'" class="popable" src="//static.vici.org/cache/260x0-3'+g.path+'">'),vici.popupsArr[f]='<div id="popup'+f+'">'+b(g)+"</div>"}setInnerHTML("moreimages",d);for(var f in a.properties.images)document.getElementById("img"+f).onclick=function(a){return function(b){stopPropagation(b);var c=getEventCoords(b);togglePopup(a,c.x,c.y)}}(f)}setInnerHTML("copyright",strings.Footer.format(a.properties.creatorName,a.properties.createDate,a.properties.editorName,a.properties.editDate)),a.properties.text.length>vici.markerArr[vici.selectedMarkerId].html.length&&setInnerHTML("text",a.properties.text),getInnerHTML("text").length<a.properties.altText.length&&(setInnerHTML("otherlang","<h2>"+strings.AltLang+":</h2>"+a.properties.altText),document.getElementById("otherlang").style.display="block")}vici.popupsArr=[],document.getElementById("otherlang").style.display="none",setInnerHTML("moreimages",""),a?(setInnerHTML("ttitle","Vici.org mobile"),setInnerHTML("defaultimage",'<img src="/images/vici_org.png" width="126" height="72">'),setInnerHTML("text","<p>Vici.org mobile</p><p>V 2.0 beta 4 - René Voorburg 2013 - rene@digitopia.nl</p><p>Visit http://vici.org/</p>"),setInnerHTML("copyright","")):(setInnerHTML("ttitle",vici.markerArr[vici.selectedMarkerId].title),setInnerHTML("text","<p>"+vici.markerArr[vici.selectedMarkerId].html+"</p>"),vici.markerArr[vici.selectedMarkerId].picture?setInnerHTML("defaultimage",'<img id="img0" class="popable" src="//static.vici.org/cache/260x146-2'+vici.markerArr[vici.selectedMarkerId].picture+'" width="260" height="146">'):setInnerHTML("defaultimage",""),ajax({url:base+"/object.php?id="+vici.markerArr[vici.selectedMarkerId].id,dataType:"json",success:c})),document.getElementById("page").style.display="block",document.getElementById("mapcanvas").style.display="none"}function closePage(){removePopup(),document.getElementById("mapcanvas").style.display="block",document.getElementById("page").style.display="none",google.maps.event.trigger(vici.map,"resize")}function closeMessage(){document.getElementById("infobox").innerHTML="",vici.markerArr[vici.selectedMarkerId].restoreState(),vici.selectedMarkerId=null,vici.auraMarker.setVisible(!1)}function loadData(a){function b(a,b,c){function e(){for(var a,f=+new Date;f+100>=+new Date;){if(a=d.shift(),!a)return;b(a)}setTimeout(e,c)}c=c||10;var d=a.slice(0);e()}function c(a){var b=vici.markerArr[a];vici.selectedMarkerId=a,b.raiseState(),vici.auraMarker.position=b.position,vici.auraMarker.setVisible(!0),vici.auraMarker.setIcon(vici.auraMarker.icon)}function d(a,b){var d,e,f;vici.selectedMarkerId&&vici.selectedMarkerId!=a.id&&vici.markerArr[vici.selectedMarkerId].restoreState(),a.id==vici.selectedMarkerId?showPage():(c(a.id),d='<div id="infoclose"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP//////zCH5BAEHAAAALAAAAAABAAEAAAICRAEAOw==" width="18" height="18"></div>',d+='<div style="padding:4px 5px 8px 5px">',d+='<img id="itopage" src="data:image/gif;base64,R0lGODlhAQABAIAAAP//////zCH5BAEHAAAALAAAAAABAAEAAAICRAEAOw==" class="marker infomarker icon'+a.kind+'" width="32" height="37">',d+="<div>"+a.title+"</div>",e=a.title==a.html?"":a.html,a.picture?(d+='<div style="margin:0 0 0 38px;position:relative;height:146px">',d+='<img  src="//static.vici.org/cache/260x146-2'+a.picture+'" width="260" height="146">',d+='<div style="position: absolute; bottom:0px; left:0px; width:260px;padding:4px 0 4px 0;background-image: url('+base+'/images/black_50.png);font-size:0.9em">'+e+' [&nbsp;<a href="#" id="atopage">'+strings.more+"</a>&nbsp;]</div>",d+="</div>"):d+='<div style="margin-left:38px;font-size:0.9em">'+e+' [&nbsp;<a href="#" id="atopage">'+strings.more+"</a>&nbsp;]</div>",f=document.getElementById("infobox"),f.innerHTML=d,new FastButton(document.getElementById("infoclose"),function(){closeMessage()}),new FastButton(document.getElementById("atopage"),function(){showPage()}),new FastButton(document.getElementById("itopage"),function(){showPage()})),b&&vici.map.panTo(a.position)}function e(){var b=new google.maps.LatLngBounds(new google.maps.LatLng(vici.areaLoaded.latSW,vici.areaLoaded.lngSW),new google.maps.LatLng(vici.areaLoaded.latNE,vici.areaLoaded.lngNE)),c=a.getZoom();for(var d in vici.markerArr)(!b.contains(vici.markerArr[d].getPosition())||vici.markerArr[d].zoom_small>c)&&(google.maps.event.clearInstanceListeners(vici.markerArr[d]),vici.markerArr[d].setMap(null),delete vici.markerArr[d])}function f(a){e(),g(a),h(a),vici.areaLoaded.assign(vici.areaRequested)}function g(c){function h(b){if(!vici.markerArr[b.properties.id]){var c=new google.maps.Marker({id:b.properties.id,url:base+b.properties.url,position:new google.maps.LatLng(b.geometry.coordinates[1],b.geometry.coordinates[0]),map:a,title:b.properties.title,html:b.properties.summary,objectvisible:"1"==b.properties.isvisible,zoom_small:parseInt(b.properties.zoomsmall),zoom_normal:parseInt(b.properties.zoomnormal),image_small:markerImages[b.properties.kind].small,image_normal:markerImages[b.properties.kind].normal,state_high:!1,icon:null,kind:b.properties.kind,picture:b.properties.img,zIndex:b.properties.zindex,selectImage:g,restoreState:e,raiseState:f});c.selectImage(),google.maps.event.addListener(c,"click",function(){d(this,!1)}),vici.markerArr[c.id]=c}}var e=function(){this.state_high&&(this.state_high=!1,this.zIndex=this.zIndex-20,this.selectImage())},f=function(){this.state_high||(this.state_high=!0,this.zIndex=this.zIndex+20,this.icon=this.image_normal,this.setIcon(this.icon))},g=function(){var b=a.getZoom(),c=this.state_high,d=this.zoom_small<=b,e=vici.showAllMarkers||this.objectvisible;this.visible=c||d&&e,b>=this.zoom_normal||this.state_high?this.icon=this.image_normal:this.icon=this.image_small,this.setIcon(this.icon)};b(c.features,h,100)}function h(c){function f(b){var c=vici.map.getZoom();if(!vici.polylineArr[b.id]||vici.polylineArr[b.id]&&vici.polylineArr[b.id].expire<=c){var f=[];for(var g in b.points)f.push(new google.maps.LatLng(b.points[g][0],b.points[g][1]));var h={path:f,markerId:b.marker,strokeColor:"#FF0000",strokeOpacity:1,nominalWeight:3,expire:b.expire,growZoom:16,calcWeight:e};switch(b.kind){case"aqueduct":h.strokeColor="#00ECF7",h.nominalWeight=2;break;case"canal":h.strokeColor="#1111FF",h.nominalWeight=3,h.growZoom=16;break;case"road":break;case"wall":h.growZoom=17,h.strokeColor="#C4A548";break;case"other":h.nominalWeight=2,h.growZoom=19,h.strokeColor="#fdff0c"}if(h.strokeWeight=h.calcWeight(c),vici.polylineArr[b.id])vici.polylineArr[b.id].setOptions(h);else{var i=new google.maps.Polyline(h);i.setMap(a),google.maps.event.addListener(i,"click",function(){d(vici.markerArr[this.markerId],!0)}),vici.polylineArr[b.id]=i}}}var e=function(a){var b=1+a-this.growZoom;return 0>b&&(b=0),this.nominalWeight*Math.pow(2,b)};b(c.lines,f,10)}vici.areaRequested.fill(a.getBounds()),vici.areaRequested.equals(vici.areaLoaded)||ajax({url:base+"/data.php?numeric&bounds="+vici.areaRequested.latSW+","+vici.areaRequested.lngSW+","+vici.areaRequested.latNE+","+vici.areaRequested.lngNE+"&zoom="+a.getZoom()+"&lang="+vici.lang,dataType:"json",success:f})}function initialize(){new FastButton(document.getElementById("btnfocus"),function(){vici.gpsInitialized&&trackLocation(!vici.trackLocation)}),new FastButton(document.getElementById("btnall"),function(){displayAllMarkers(!0)}),new FastButton(document.getElementById("btnvisual"),function(){displayAllMarkers(!1)}),new FastButton(document.getElementById("btnlabels"),function(){displayLabels(!vici.showLabels)}),new FastButton(document.getElementById("btninfo"),function(){showPage(!0)}),new FastButton(document.getElementById("backtxt"),function(){closePage()}),document.getElementById("backtxt").innerHTML=strings.Back,document.getElementById("btnall").innerHTML=strings.All,document.getElementById("btnvisual").innerHTML=strings.Visible;var a=function(){},b=function(a){vici.here=new google.maps.Marker({position:new google.maps.LatLng(a.coords.latitude,a.coords.longitude),map:vici.map,icon:new google.maps.MarkerImage(base+"/images/mobile.png",new google.maps.Size(15,15),new google.maps.Point(81,104),new google.maps.Point(8,8))}),vici.here.setIcon(vici.here.icon)},c={center:new google.maps.LatLng(50.84,5.69),zoom:12,minZoom:10,streetViewControl:!1,panControl:!1,zoomControl:!1,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.SATELLITE};if(vici.map=new google.maps.Map(document.getElementById("mapcanvas"),c),navigator.geolocation){vici.locationAware=!0,navigator.geolocation.getCurrentPosition(function(a){vici.gpsInitialized=!0,b(a),trackLocation(vici.trackLocation)},a,{enableHighAccuracy:!0,timeout:1e4,maximumAge:2e4});navigator.geolocation.watchPosition(function(a){vici.gpsInitialized?(vici.here.position=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),vici.here.setIcon(vici.here.icon)):(vici.gpsInitialized=!0,b(a),trackLocation(vici.trackLocation)),vici.trackLocation&&vici.map.setCenter(vici.here.position)},a,{enableHighAccuracy:!0,timeout:3e4,maximumAge:27e3})}else vici.locationAware=!1;google.maps.event.addListener(vici.map,"bounds_changed",function(){if(loadData(vici.map),vici.selectedMarkerId){var a=this.getBounds();a.contains(vici.markerArr[vici.selectedMarkerId].position)||closeMessage()}}.debounce(300)),google.maps.event.addListener(vici.map,"zoom_changed",function(){var a=vici.map.getZoom();updateMarkerImages(vici.markerArr);for(var b in vici.polylineArr)vici.polylineArr[b].strokeWeight=vici.polylineArr[b].calcWeight(a),vici.polylineArr[b].setOptions(vici.polylineArr[b])}.debounce(300)),google.maps.event.addListener(vici.map,"dragend",function(){vici.gpsInitialized&&trackLocation(!1)}.debounce(300)),document.addEventListener("orientationchange",function(){vici.trackLocation&&vici.map.setCenter(vici.here.position)}),vici.auraMarker=new google.maps.Marker({position:new google.maps.LatLng,map:vici.map,visible:!1,icon:new google.maps.MarkerImage(base+"/images/markers.png",new google.maps.Size(32,37),new google.maps.Point(928,0),new google.maps.Point(16,37)),zIndex:15})}Function.prototype.debounce||(Function.prototype.debounce=function(a,b){var d,c=this;return function(){function g(){b||c.apply(e,f),d=null}var e=this,f=arguments;d?clearTimeout(d):b&&c.apply(e,f),d=setTimeout(g,a||100)}}),String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1});for(var vici={lang:function(){var a=(window.navigator.userLanguage||window.navigator.language).substring(0,2);return inArray(a,["de","en","fr","nl"])<0&&(a="en"),a}(),map:null,here:null,markerArr:[],polylineArr:[],areaLoaded:new normalizedArea,areaRequested:new normalizedArea,popupsArr:[],selectedMarkerId:null,selectedImage:null,auraMarker:null,showLabels:!1,showAllMarkers:!0,gpsInitialized:!1,locationAware:!1,trackLocation:!0},strings=function(a){var b={de:{AltLang:"Alternative Sprache",Back:"Zurück",All:"Alles",CreatedBy:"Bild von ",Close:"Schließen",Footer:"Hinzugefügt von {0} am {1}. Zuletzt bearbeitet von {2} am {3}. Creative Commons Attribution-ShareAlike 3.0",MoreImages:"Weitere Bilder",more:"weiter",show:"anzeigen",Visible:"Sichtbar"},en:{AltLang:"In an other language",Back:"Back",All:"All",Close:"Close",CreatedBy:"By ",Footer:"Added by {0} on {1}. Last edited by {2} on {3}. Creative Commons Attribution-ShareAlike 3.0",MoreImages:"More images",more:"more",show:"show",Visible:"Visible"},fr:{AltLang:"Autre langue",Back:"Retour",All:"Tout",Close:"Fermer",CreatedBy:"Image par ",Footer:"Ajouté par {0} le {1}. Dernière modification par {2} le {3}. Creative Commons Attribution-ShareAlike 3.0",MoreImages:"More images",more:"plus",show:"exposer",Visible:"Visible"},nl:{AltLang:"In een alternatieve taal",Back:"Terug",All:"Alles",Close:"Sluiten",CreatedBy:"Afbeelding door ",Footer:"Toegevoegd door {0} op {1}. Laatste bewerking door {2} op {3}. Creative Commons Attribution-ShareAlike 3.0",MoreImages:"Meer afbeeldingen",more:"meer",show:"tonen",Visible:"Zichtbaar"}};return b[a]}(vici.lang),base="",markerImages=[],i=1;26>i;i++)markerImages[i]={small:new google.maps.MarkerImage(base+"/images/markers_minimal.png",new google.maps.Size(12,12),new google.maps.Point(12*i-12,0),new google.maps.Point(6,6)),normal:new google.maps.MarkerImage(base+"/images/markers.png",new google.maps.Size(32,37),new google.maps.Point(32*i-32,0),new google.maps.Point(16,37))};google.maps.event.addDomListener(window,"load",initialize);